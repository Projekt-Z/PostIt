@using Microsoft.AspNetCore.Mvc.TagHelpers
@using PostIt.Web.Services
@model IEnumerable<Post>

@inject IUserService _userService

@{
    ViewData["Title"] = "Home Page";
}

@if (Context.User.Identity.IsAuthenticated)
{
    var user = _userService.GetByUsername(User.Identity.Name);
    
    <div id="who_to_follow" class="w-25 h-auto">
        <h5>Who to follow?</h5>
        @foreach (var user1 in _userService.GetMostFollowedDesc(5, user.Username))
        {
            <div>
                <h6>
                    <img alt="profile" src="@user1.ImageUrl" width="20" height="20" class="rounded-circle"/>
                    <a asp-action="Index" asp-controller="Profile" asp-route-username="@user1.Username">&#64;@user1.Username</a>
                </h6>

                <a>Followers: @user1.Followers.Count</a>
                
                @if (user!.Following.Any(x => x.UserId == user1.Id) || user.Following.Count == 0)
                {
                    <a asp-action="Follow" asp-route-id="@user1.Id">Follow</a>
                }
                else 
                {
                    <a>Following</a>
                }
                  
                <hr />
            </div>
        }
    </div>
    
    <div class="text-center">
        <h1 class="display-4">Welcome @Context.User.Identity.Name !</h1>
        
        <p>
            <a asp-action="Post" asp-controller="Home">Write a Post!</a>
        </p>
        
        <div class="main-posts">
            @foreach (var post in Model)
            {
                
                <div class="post">
                    <a asp-action="Index" id="a" asp-controller="Post" asp-route-id="@post.Id">
                        <h4> @post.Title </h4>

                        <p> @post.Description </p>
                        <a>@post.TimeAdded |</a> 
                        <a asp-action="Index" asp-controller="Profile" asp-route-username="@post.Author.Username">&#64;@post.Author.Username</a>
                
                        @if(!string.IsNullOrEmpty(post.MediaLink))
                        {
                            <img src="@post.MediaLink" alt="Image" style="width: 30vw; height: 20vh;" />
                        }

                        @if (post.Author.Username == Context.User.Identity.Name)
                        {
                            <a asp-action="Delete" asp-route-id="@post.Id">Delete</a>
                        }
                
                        <p>
                
                            @if(Context.User.Identity.IsAuthenticated) 
                            {
                                if (!post.Likes.Contains(user))
                                {
                                    <a asp-action="Like" asp-controller="Home" asp-route-id="@post.Id">🤍 @post.Likes.Count</a>
                                }
                                else if (post.Likes.Contains(user))
                                {
                                    <a asp-action="Unlike" asp-controller="Home" asp-route-id="@post.Id">&#10084; @post.Likes.Count</a>
                                }
                            }
                            
                            <a>&#128488; @post.Comments.Count</a> 
                        
                        </p>
                    </a>
                </div>
              
            }
        </div>
        
    </div>
}
else
{
    <p class="text-center">Please
    
        <a asp-controller="Authentication" asp-action="GoogleLogin">Log In with google</a> <br/>
        <a asp-controller="User" asp-action="Create">Create new account</a> <br/>
        <a asp-controller="User" asp-action="Login">Log In</a> <br/>
        
        in order to use this App
    </p>
}

<style>

.post {
    background-color: rgb(237, 235, 235);
    width: 80%;
    height: 200px;
    border: 1px solid black;
    margin: 10px auto 0;
}

a#a {
    height: 100%;
    width: 100%;
    text-decoration: none;
}

a {
    text-decoration: none;
    color: black;
}

</style>